function openSettings() {
    // 1. Đổ dữ liệu hiện tại vào Form
    document.getElementById('apiKeyInput').value = config.apiKey;
    document.getElementById('customUrlInput').value = config.customUrl;
    document.getElementById('systemPromptInput').value = config.systemPrompt;
    document.getElementById('tempInput').value = config.temperature; 
    document.getElementById('tempDisplay').innerText = config.temperature;
    
    const topPEl = document.getElementById('topPInput');
    if(topPEl) {
        topPEl.value = config.topP;
        document.getElementById('topPDisplay').innerText = config.topP;
    }
    document.getElementById('visionModelInput').value = config.visionModel;
    
    // 2. Cập nhật trạng thái nút gạt Vision
    const vBtn = document.getElementById('visionToggleBtn');
    if(vBtn) {
        const switchEl = vBtn.querySelector('.toggle-switch') || vBtn;
        if(config.useVision) {
            switchEl.style.background = '#fbbf24';
            switchEl.innerHTML = '<div style="position:absolute; top:2px; left:14px; width:14px; height:14px; background:white; border-radius:50%;"></div>';
        } else {
            switchEl.style.background = '#334155';
            switchEl.innerHTML = '<div style="position:absolute; top:2px; left:2px; width:14px; height:14px; background:white; border-radius:50%;"></div>';
        }
    }
    
    // 3. Render các thành phần phụ thuộc
    renderModelList();
    updateLicenseStatusDisplay();

    // 4. Hiển thị Modal
    if(settingsModal) {
        settingsModal.classList.add('active');
    } else {
        console.error("Không tìm thấy ID 'settingsModal'!");
    }
}
