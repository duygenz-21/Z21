<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid Visualizer Minimal</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ§œâ€â™€ï¸</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        window.mermaid = mermaid;
        mermaid.initialize({ startOnLoad: false, theme: 'default' });
    </script>
</head>
<body>

    <header class="top-bar">
        <div class="logo">ğŸ§œâ€â™€ï¸ Mermaid Flow</div>
        <div class="top-actions">
            <button class="icon-btn" onclick="downloadCode()" title="Táº£i Code">â¬‡ï¸</button>
            <button class="icon-btn" onclick="toggleSettings()" title="CÃ i Ä‘áº·t">âš™ï¸</button>
        </div>
    </header>

    <main class="main-canvas">
        <div class="mermaid-wrapper" id="mermaidContainer">
            </div>
        
        <button class="code-toggle-btn" onclick="toggleCodeEditor()">ğŸ› ï¸ Code</button>
        <div id="codeEditorPanel" class="code-panel hidden">
            <textarea id="mermaidCodeEditor" spellcheck="false" oninput="manualEdit()"></textarea>
        </div>
    </main>

    <div class="floating-chat-container">
        <div class="chat-bar">
            <input type="text" id="userRequest" placeholder="Nháº­p yÃªu cáº§u Ä‘á»ƒ AI váº½ láº¡i..." onkeydown="if(event.key === 'Enter') callAiUpdate()">
            <button class="send-btn" onclick="callAiUpdate()">ğŸš€</button>
        </div>
        <div id="spinner" class="mini-spinner hidden">Creating...</div>
    </div>

    <div id="settingsModal" class="modal-overlay hidden" onclick="closeSettings(event)">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âš™ï¸ Cáº¥u hÃ¬nh Há»‡ thá»‘ng</h2>
                <button class="close-btn" onclick="toggleSettings()">Ã—</button>
            </div>
            
            <div class="setting-group">
                <label>API Key</label>
                <input type="password" id="apiKeyInput" placeholder="sk-..." onchange="saveApiKey()">
            </div>

            <div class="setting-group">
                <label>Model</label>
                <select id="modelSelect">
                    <option value="deepseek/deepseek-v3">deepseek/deepseek-v3</option>
                    <option value="openai/gpt-4o">openai/gpt-4o</option>
                    <option value="anthropic/claude-3-5-sonnet">anthropic/claude-3-5-sonnet</option>
                </select>
            </div>

            <div class="row-group">
                <div class="col">
                    <label>Temperature (<span id="tempVal">0.7</span>)</label>
                    <input type="range" id="tempRange" min="0" max="2" step="0.1" value="0.7" oninput="updateParamsDisplay()">
                </div>
                <div class="col">
                    <label>Top K (<span id="topKVal">40</span>)</label>
                    <input type="range" id="topKRange" min="0" max="100" step="1" value="40" oninput="updateParamsDisplay()">
                </div>
            </div>

            <div class="setting-group">
                 <label>ğŸ“‚ Táº£i file dá»¯ liá»‡u</label>
                 <input type="file" id="fileUpload" accept=".md,.txt,.mmd" onchange="handleFileUpload()">
            </div>

            <div class="modal-footer">
                <button class="st-btn danger" onclick="resetApp()">ğŸ”„ Reset App</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast hidden">ThÃ´ng bÃ¡o</div>

    <script src="script.js"></script>
</body>
</html>
