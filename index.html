<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid Visualizer</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ§œâ€â™€ï¸</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        window.mermaid = mermaid;
        mermaid.initialize({ startOnLoad: false, theme: 'default' });
    </script>
</head>
<body>

    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-content">
                <h2>âš™ï¸ CÃ i Ä‘áº·t</h2>
                
                <div class="expander open">
                    <div class="expander-header" onclick="toggleExpander(this)">
                        <span>ğŸ”‘ Cáº¥u hÃ¬nh AI</span>
                        <span class="arrow">â–¼</span>
                    </div>
                    <div class="expander-content">
                        <label class="label">API Key</label>
                        <input type="password" id="apiKeyInput" placeholder="sk-..." onchange="saveApiKey()">
                        
                        <label class="label">Model</label>
                        <select id="modelSelect">
                            <option value="deepseek/deepseek-v3.2">deepseek/deepseek-v3.2</option>
                            <option value="openai/gpt-oss-120b">openai/gpt-oss-120b</option>
                            <option value="xiaomi/mimo-v2-flash">xiaomi/mimo-v2-flash</option>
                            <option value="anthropic/claude-3-haiku">anthropic/claude-3-haiku</option>
                        </select>

                        <label class="label">Äá»™ sÃ¡ng táº¡o (<span id="tempVal">0.7</span>)</label>
                        <input type="range" id="tempRange" min="0" max="2" step="0.1" value="0.7" oninput="updateTempDisplay()">
                    </div>
                </div>

                <hr class="divider">

                <h3>ğŸ“‚ Táº£i Dá»¯ liá»‡u</h3>
                <label class="file-upload-btn">
                    Chá»n file (md, txt, mmd...)
                    <input type="file" id="fileUpload" accept=".md,.txt,.mmd,.py,.js" onchange="handleFileUpload()">
                </label>

                <div id="cleanupMsg" class="info-box hidden">ğŸ§¹ ÄÃ£ dá»n dáº¹p dá»¯ liá»‡u cÅ©.</div>

                <hr class="divider">

                <button class="st-btn" onclick="resetApp()">ğŸ”„ Reset App</button>
            </div>
        </aside>

        <main class="main-content">
            <div class="header-section">
                <h1>ğŸ§œâ€â™€ï¸ Mermaid Flow</h1>
                <p class="caption">Biáº¿n Ã½ tÆ°á»Ÿng thÃ nh hÃ¬nh áº£nh ngay láº­p tá»©c.</p>
            </div>

            <div class="result-bar">
                <h3>ğŸ‘ï¸ Káº¿t quáº£</h3>
                <button class="st-btn download-btn" onclick="downloadCode()">â¬‡ï¸ Táº£i Code</button>
            </div>

            <div class="mermaid-container" id="mermaidContainer">
                </div>

            <hr class="divider">

            <h3>âœï¸ Chá»‰nh sá»­a vá»›i AI</h3>
            <div class="chat-controls">
                <input type="text" id="userRequest" placeholder="VÃ­ dá»¥: Äá»•i mÃ u node Báº¯t Ä‘áº§u thÃ nh mÃ u xanh..." class="st-input">
                <button id="sendBtn" class="st-btn primary-btn" onclick="callAiUpdate()">ğŸš€ Gá»­i</button>
            </div>
            
            <div id="toast" class="toast hidden">ThÃ´ng bÃ¡o</div>
            
            <div id="spinner" class="spinner-overlay hidden">
                <div class="spinner"></div>
                <div class="spinner-text">ğŸ¤– AI Ä‘ang váº½ láº¡i...</div>
            </div>

            <div class="expander collapsed" style="margin-top: 20px;">
                <div class="expander-header" onclick="toggleExpander(this)">
                    <span>ğŸ› ï¸ Xem Code Nguá»“n (Dev)</span>
                    <span class="arrow">â–¶</span>
                </div>
                <div class="expander-content">
                    <textarea id="mermaidCodeEditor" class="code-editor" spellcheck="false" oninput="manualEdit()"></textarea>
                </div>
            </div>
        </main>
    </div>

    <script src="script.js"></script>
</body>
</html>
